<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å¡”ç¾…å åœ (è³‡æ–™åº«æ•´åˆç‰ˆ)</title>
    <style>
	.controls {
            position: absolute;
            bottom: 40px;
            z-index: 200;
            display: flex; /* é›»è…¦ç‰ˆç¶­æŒä¸€æ’ */
            gap: 20px;
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 50px;
        }
        :root {
            --card-w: 120px;
            --card-h: 210px;
        }

        body { 
            font-family: 'Helvetica', sans-serif; 
            background: radial-gradient(circle at center, #1a1a1a, #000); 
            color: white; 
            margin: 0; 
            
            /* â˜…â˜…â˜… ä¿®æ”¹ï¼šæ”¹ç”¨ dvh (å‹•æ…‹è¦–çª—é«˜åº¦)ï¼Œè§£æ±ºæ‰‹æ©Ÿç¶²å€åˆ—é®æ“‹å•é¡Œ â˜…â˜…â˜… */
            height: 100dvh; 
            
            overflow: hidden; 
            display: flex;
            flex-direction: column;
            align-items: center;

            /* â˜…â˜…â˜… æ–°å¢ï¼šç¦æ­¢æ‰‹æŒ‡è§¸æ§ç¸®æ”¾è¡Œç‚º â˜…â˜…â˜… */
            touch-action: pan-x pan-y; 
            
            /* â˜…â˜…â˜… æ–°å¢ï¼šé˜²æ­¢æ‰‹æ©Ÿæ©«ç›´å‘åˆ‡æ›æ™‚æ–‡å­—å¿½å¤§å¿½å° â˜…â˜…â˜… */
            -webkit-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }

.modal-card-img-container {
    text-align: center;
    padding-bottom: 20px;
    margin-top: 20px;
    border-top: 1px solid #333; /* åŠ ä¸€æ¢åˆ†éš”ç·š */
}

.card.selected {
    box-shadow: 0 0 15px #f1c40f, 0 0 30px #f1c40f !important;
    border-color: #fff;
    z-index: 1000 !important;
}
#focusOverlay {
    position: fixed;
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%;
    background: #000; /* å…¨é»‘èƒŒæ™¯ */
    z-index: 40000; /* æ¯”æ‰€æœ‰æ±è¥¿éƒ½é«˜ */
    display: none; /* é è¨­éš±è— */
    flex-direction: column; 
    justify-content: center; 
    align-items: center;
    opacity: 0;
    transition: opacity 1.5s ease-in-out; /* ç·©æ…¢æ·¡å…¥æ·¡å‡º */
}

.focus-text {
    color: #d4af37;
    font-size: 24px;
    letter-spacing: 5px;
    font-weight: 300;
    animation: breathe 3s infinite ease-in-out; /* æ–‡å­—å‘¼å¸æ•ˆæœ */
}

@keyframes breathe {
    0%, 100% { opacity: 0.6; transform: scale(0.95); }
    50% { opacity: 1; transform: scale(1.05); }
}

/* è®“æ§åˆ¶é¢æ¿æœ‰æ·¡å‡ºå‹•ç•«æ•ˆæœ */
.controls, .hint {
    transition: opacity 0.5s;
}
.modal-card-img {
    width: 150px; /* è¨­å®šé©ç•¶å¯¬åº¦ */
    max-width: 70%;
    height: auto;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    border: 2px solid #d4af37;
    transition: transform 0.3s; /* æ—‹è½‰æ™‚æœ‰å‹•ç•« */
    margin-top: 10px;
}
/* â˜…â˜…â˜… å¼·åˆ¶ä¿®æ­£ç‰ˆï¼šé ‚éƒ¨æç¤ºæ–‡å­— â˜…â˜…â˜… */
        .hint {
            position: absolute !important;
            top: 15% !important; /* å¼·åˆ¶å¾€ä¸‹ç§»ï¼Œä¸è¦è²¼åœ¨æœ€ä¸Šé¢ */
            left: 50% !important;
            transform: translateX(-50%) !important;
            z-index: 20002 !important; /* â˜… é—œéµï¼šè¨­å®šè¶…é«˜å±¤ç´šï¼Œç¢ºä¿æµ®åœ¨æ‰€æœ‰ç‰Œè·Ÿè¦–çª—ä¸Šé¢ */
            
            /* å¤–è§€è¨­å®šï¼šé»‘åº•é‡‘é‚Šï¼Œè¶…é«˜è¾¨è­˜åº¦ */
            background: rgba(0, 0, 0, 0.9) !important;
            color: #f1c40f !important;
            border: 2px solid #f1c40f !important;
            border-radius: 50px !important;
            padding: 15px 40px !important;
            
            /* æ–‡å­—è¨­å®š */
            font-size: 20px !important;
            font-weight: bold !important;
            letter-spacing: 2px !important;
            text-align: center !important;
            white-space: nowrap !important;
            
            /* ç™¼å…‰ç‰¹æ•ˆ */
            box-shadow: 0 0 20px rgba(241, 196, 15, 0.5) !important;
            pointer-events: none; /* è®“é»æ“Šç©¿é€ï¼Œä¸æ“‹ä½ä¸‹é¢çš„æ“ä½œ */
            transition: all 0.3s ease;
        }

        /* æ‰‹æ©Ÿç‰ˆç‰¹åˆ¥èª¿æ•´ */
        @media (max-width: 600px) {
    select {
        max-width: none !important; /* â˜…â˜…â˜… å¼·åˆ¶å–æ¶ˆ 100px é™åˆ¶ â˜…â˜…â˜… */
        width: 100% !important;     /* ç¢ºä¿ä½”æ»¿ */
        font-size: 16px !important; /* å­—é«”å¤§ä¸€é»æ¯”è¼ƒå¥½é» */
        margin-bottom: 10px;        /* åŠ é»é–“è· */
            }
    }
/* è«‹æ‰¾åˆ°åŸæœ¬çš„ .nav-btn ä¸¦æ›¿æ›æˆä¸‹é¢é€™æ®µ */
.nav-btn {
    background: rgba(20, 20, 20, 0.6); /* åŠ å…¥åŠé€æ˜èƒŒæ™¯å¢åŠ è¾¨è­˜åº¦ */
    border: 1px solid #d4af37;
    color: #d4af37;
    font-size: 20px; /* èª¿æ•´ç®­é ­å¤§å° */
    cursor: pointer;
    transition: all 0.3s;
    
    /* â˜…â˜…â˜… é—œéµä¿®æ”¹ï¼šè£½ä½œåœ“å½¢æŒ‰éˆ• â˜…â˜…â˜… */
    width: 44px;            /* è¨­å®šå›ºå®šå¯¬åº¦ */
    height: 44px;           /* è¨­å®šå›ºå®šé«˜åº¦ (éœ€èˆ‡å¯¬åº¦ç›¸åŒ) */
    border-radius: 50%;     /* è¨­å®šç‚ºåœ“å½¢ */
    padding: 0;             /* æ¸…é™¤åŸæœ¬çš„å…§è· */
    
    /* è®“ç®­é ­åœ¨åœ“åœˆä¸­å®Œç¾å±…ä¸­ */
    display: flex;
    justify-content: center;
    align-items: center;
    
    /* å¢åŠ ä¸€é»ç«‹é«”æ„Ÿ (å¯é¸) */
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

/* æ»‘é¼ ç§»éå»çš„æ•ˆæœ */
/* â˜…â˜…â˜… è«‹ç”¨é€™æ®µå–ä»£åŸæœ¬æ‰€æœ‰çš„ .nav-btn è¨­å®š â˜…â˜…â˜… */

.nav-btn {
    /* 1. å®šä½è¨­å®šï¼šçµ•å°å®šä½ï¼Œç¢ºä¿æµ®åœ¨è¦–çª—ä¸Š */
    position: absolute !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    z-index: 30005 !important; /* æ¯” Modal å…§å®¹æ›´é«˜ */

    /* 2. å¤–è§€è¨­å®šï¼šæ­£åœ“å½¢ */
    width: 45px !important;
    height: 45px !important;
    border-radius: 50% !important;
    
    /* 3. é¡è‰²èˆ‡é‚Šæ¡† */
    background: rgba(0, 0, 0, 0.8) !important; /* æ·±é»‘åº•è‰²ï¼Œå¢åŠ å°æ¯” */
    border: 1px solid #d4af37 !important;
    color: #d4af37 !important;
    
    /* 4. å…§å®¹æ’ç‰ˆï¼šè®“ç®­é ­ä¹–ä¹–åœ¨åœ“åœˆä¸­é–“ */
    display: flex !important;
    justify-content: center !important;
    align-items: center !important;
    padding: 0 !important; /* æ¸…é™¤å…§è·ï¼Œé¿å…åœ“å½¢è®Šå½¢ */
    font-size: 20px !important;
    cursor: pointer;
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

/* 5. å·¦å³ä½ç½®å¼·åˆ¶è¨­å®š */
.nav-btn.prev {
    left: 10px !important;  /* å›ºå®šåœ¨å·¦å´ */
    right: auto !important; /* æ¸…é™¤å³å´è¨­å®š */
}

.nav-btn.next {
    right: 10px !important; /* å›ºå®šåœ¨å³å´ */
    left: auto !important;  /* æ¸…é™¤å·¦å´è¨­å®š */
}

/* æŒ‰ä¸‹æˆ–æ»‘é¼ ç¶“éçš„æ•ˆæœ */
.nav-btn:active, .nav-btn:hover {
    background: #d4af37 !important;
    color: #000 !important;
    transform: translateY(-50%) scale(1.1) !important; /* é»æ“Šæ™‚ç¨å¾®æ”¾å¤§ */
}

            :root {
                --card-w: 80px; 
                --card-h: 140px;
            }

            /* 1. é ‚éƒ¨æç¤ºæ–‡å­—ï¼šå…è¨±è‡ªå‹•æ›è¡Œ */
            .hint {
                top: 12% !important;           /* ä½ç½®ç¨å¾®ä¸‹ä¾†ä¸€é» */
                font-size: 15px !important;
                padding: 10px 20px !important;
                width: 85% !important;         /* é™åˆ¶å¯¬åº¦ */
                white-space: normal !important; /* â˜… é—œéµï¼šå…è¨±æ–‡å­—æ›è¡Œ â˜… */
                line-height: 1.5 !important;    /* å¢åŠ è¡Œé«˜ï¼Œé–±è®€èˆ’é© */
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* 2. æ§åˆ¶é¢æ¿ï¼šç¶­æŒåŸæœ¬çš„ Grid æ’ç‰ˆ (ä½ç½®ä¸è®Š) */
            .controls {
                bottom: 0; 
                padding: 15px 15px 35px 15px; 
                width: 100%;
                border-radius: 20px 20px 0 0;
                gap: 10px; 
                background: rgba(0,0,0,0.95);
                box-sizing: border-box; 
                
                display: grid; 
                grid-template-columns: 1fr 1fr; /* ç¶­æŒå·¦å³å…©æ¬„ */
                grid-template-rows: auto;
                left: 0; 
            }

            /* 3. çµ±ä¸€æ¨£å¼ï¼šè®“é¸å–®(Select) è·Ÿ æŒ‰éˆ•(Button) é•·å¾—ä¸€æ¨£é«˜ã€ä¸€æ¨£å¤§ */
            #categorySelector, 
            #spreadBasic, 
            #spreadAdv, 
            #btnShuffle, 
            #btnSpread {
                font-size: 16px;      /* å­—é«”çµ±ä¸€ */
                padding: 15px 5px;    /* â˜… é—œéµï¼šå…§è·åŠ å¤§ï¼Œè®“å®ƒå€‘è·ŸæŒ‰éˆ•ä¸€æ¨£é«˜ â˜… */
                border-radius: 10px;
                box-sizing: border-box;
                height: auto;         /* è®“ padding æ’é–‹é«˜åº¦ */
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* ä½ç½®è¨­å®š (ç¶­æŒä¸è®Š) */
            #categorySelector {
                grid-column: 1 / -1; /* è·¨æ»¿æ•´è¡Œ */
                width: 100%;
                /* ä¿®é£¾é¸å–®ç®­é ­ä½ç½® */
                appearance: none;
                -webkit-appearance: none;
                background-color: rgba(0, 0, 0, 0.8);
                border: 1px solid #d4af37;
                background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23d4af37%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
                background-repeat: no-repeat;
                background-position: right 15px top 50%;
                background-size: 12px auto;
                text-align-last: center;
            }

            #spreadBasic, #spreadAdv {
                grid-column: span 1; /* å„ä½”ä¸€åŠ */
                width: 100%;
                font-size: 14px; /* å­—ç¨å¾®å°ä¸€é»ä»¥å…æ“ ä¸ä¸‹ */
                /* ä¿®é£¾é¸å–® */
                appearance: none;
                -webkit-appearance: none;
                background-color: rgba(0, 0, 0, 0.8);
                border: 1px solid #d4af37;
                text-align-last: center;
            }

            #btnShuffle, #btnSpread {
                grid-column: span 1; /* å„ä½”ä¸€åŠ */
                width: 100%;
            }

            /* è§£ç‰ŒæŒ‰éˆ•ç¶­æŒç‰¹å¤§è™Ÿ */
            #btnReveal {
                grid-column: 1 / -1;
                width: 100%;
                padding: 18px 0;
                font-size: 20px;
                font-weight: bold;
                background: rgba(241, 196, 15, 0.15);
                margin-top: 5px;
                border-radius: 10px;
            }
            
            #btnReset {
                grid-column: 1 / -1;
                width: 100%;
                padding: 12px;
                border-radius: 10px;
            }
        /* â˜…â˜…â˜… è«‹ç”¨é€™æ®µå–ä»£åŸæœ¬æ‰€æœ‰æ‰‹æ©Ÿç‰ˆ (@media max-width: 600px) çš„ CSS â˜…â˜…â˜… */
@media (max-width: 600px) {
    :root {
        --card-w: 80px; 
        --card-h: 140px;
    }

    .controls {
        bottom: 0; 
        padding: 20px 20px 40px 20px; 
        width: 100%;
        border-radius: 25px 25px 0 0;
        gap: 12px; 
        background: rgba(0,0,0,0.95);
        box-sizing: border-box; 
        
        /* â˜…â˜…â˜… ç¶­æŒæ‚¨è¦çš„ Grid æ’ç‰ˆï¼Œçµ•ä¸æ›´å‹• â˜…â˜…â˜… */
        display: grid; 
        grid-template-columns: 1fr 1fr; /* å·¦å³å…©æ¬„ */
        grid-template-rows: auto;
        justify-items: stretch; /* ç¢ºä¿å…§å®¹æ‹‰ä¼¸å¡«æ»¿ */
    }

    /* 1. ä¿®æ­£é¸å–®ï¼šèƒŒæ™¯æ”¹æ·±ç°(ä¸è¦æ­»é»‘)ï¼Œå­—é«”åŠ å¤§ */
    select, #categorySelector, #spreadBasic, #spreadAdv {
        max-width: none !important;
        width: 100% !important;
        height: 50px !important;
        font-size: 16px !important;
        border-radius: 12px;
        padding: 0 15px;
        margin-bottom: 5px;
        
        /* â˜… é—œéµï¼šæ”¹ç”¨æ·±ç°è‰²èƒŒæ™¯ï¼Œè§£æ±ºã€Œè®Šé»‘è‰²ã€çš„å•é¡Œ â˜… */
        background-color: #333 !important; 
        color: #d4af37 !important;
        border: 1px solid #d4af37 !important;
        
        appearance: menulist !important; /* ä¿ç•™ç®­é ­ */
    }

    /* ä½ç½®è¨­å®šï¼šç¶­æŒ Grid ä½ˆå±€ */
    #categorySelector { grid-column: 1 / -1; } /* é‹å‹¢ä½”æ»¿æ•´è¡Œ */
    #spreadBasic { grid-column: span 1; }      /* åŸºç¤ä½”å·¦é‚Š */
    #spreadAdv { grid-column: span 1; }        /* é€²éšä½”å³é‚Š */

    /* 2. æ´—ç‰Œèˆ‡å±•é–‹æŒ‰éˆ• */
    #btnShuffle, #btnSpread {
        grid-column: span 1; /* å„ä½”ä¸€åŠ */
        width: 100% !important;
        height: 50px !important;
        font-size: 18px !important;
        border-radius: 12px;
        margin: 0 !important;
    }

    /* 3. ã€Œé–‹å§‹è§£ç‰Œã€æŒ‰éˆ•ï¼šç‰¹å¤§è™Ÿã€ä½”æ»¿æ•´è¡Œ */
    #btnReveal {
        grid-column: 1 / -1 !important; /* å¼·åˆ¶ä½”æ»¿æ•´è¡Œ */
        width: 100% !important;
        padding: 18px 0 !important;     /* é«˜åº¦å¢åŠ  */
        font-size: 22px !important;
        font-weight: bold;
        background: rgba(241, 196, 15, 0.15) !important;
        color: #f1c40f !important;
        border: 2px solid #f1c40f !important;
        margin-top: 10px;
        border-radius: 12px;
        
        /* é è¨­éš±è—ï¼Œè®“ JS æ‰“é–‹å®ƒ */
        display: none; 
    }
    
    /* 4. é‡ç½®æŒ‰éˆ• */
    #btnReset {
        grid-column: 1 / -1 !important;
        width: 100% !important;
        padding: 15px !important;
        font-size: 16px;
        border-radius: 12px;
        margin-top: 5px;
        
        /* é è¨­éš±è— */
        display: none;
    }
    
    /* Modal ç®­é ­åŠ å¤§ */
    .nav-btn { font-size: 24px; padding: 15px; }
}
}
        /* --- æ¡Œé¢å€åŸŸ --- */
        .table-area {
            position: relative;
            width: 100%;
            height: 100%;
            perspective: 1200px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* --- å¡ç‰‡æœ¬é«” --- */
        .card {
            width: var(--card-w);
            height: var(--card-h);
            position: absolute;
            transform-style: preserve-3d;
            left: 50%;
            top: 50%;
            margin-left: calc(var(--card-w) / -2);
            margin-top: calc(var(--card-h) / -2);
            transform: translate(var(--tx), var(--ty)) rotate(var(--rot));
            transition: transform 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            cursor: pointer;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
        }

        /* æ‰‡å½¢å±•é–‹ç‰¹æ•ˆ */
        .card.spread:hover {
            z-index: 999 !important;
            
            /* â˜…â˜…â˜… ä¿®æ”¹ï¼šåœ¨é€™ä¸€è¡Œæœ€å¾Œé¢åŠ ä¸Š !important â˜…â˜…â˜… */
            /* é€™æ¨£æ‰èƒ½è¦†è“‹æ‰ JS è¨­å®šçš„åº§æ¨™ï¼Œè®“ç‰Œæµ®èµ·ä¾† */
            transform: translate(var(--tx), var(--ty)) rotate(var(--rot)) translateY(-40px) scale(1.1) !important;
            
            box-shadow: 0 15px 30px rgba(0,0,0,0.8);
            transition: transform 0.2s ease-out; 
        }
        .card.spread { box-shadow: -5px 0 10px rgba(0,0,0,0.3); }

        .card-inner {
            width: 100%; height: 100%; position: relative;
            transform-style: preserve-3d; transition: transform 0.8s;
        }
        .card.flipped .card-inner { transform: rotateY(180deg); }

        .front, .back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 10px; overflow: hidden;
        }

        .front {
    /* 1. è¨­å®šèƒŒæ™¯åœ–ç‰‡ */
    background-image: url('images/back.jpg'); 
    
    /* 2. ç¢ºä¿åœ–ç‰‡å¡«æ»¿ä¸”ä¸é‡è¤‡ */
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;

    /* 3. é‚Šæ¡†é¡è‰²å¯ä»¥èª¿æ•´æˆè·Ÿåœ–ç‰‡é‡‘è‰²ä¸€è‡´ */
    border: 2px solid #d4af37; 
    
    /* 4. åŠ ä¸€é»å…§é™°å½±å¢åŠ ç«‹é«”æ„Ÿ */
    box-shadow: inset 0 0 10px rgba(0,0,0,0.8);
}
        .back {
            background: #fff; transform: rotateY(180deg);
            display: flex; flex-direction: column;
        }
        
        .back-img-container { flex: 1; width: 100%; overflow: hidden; position: relative; }
        .back img { width: 100%; height: 100%; object-fit: fill; }
        
	.back-text {
 	   padding: 4px 2px; /* æ¸›å°‘å…§è· */
	}

	/* ä¸Šæ–¹çš„ã€Œä½ç½®åç¨±ã€(å¦‚ï¼šéå»ã€ç¾åœ¨) */
	.back-text div:first-child {
 	   font-size: 10px !important; /* åŸæœ¬å¯èƒ½æ¯”è¼ƒå¤§ï¼Œå¼·åˆ¶ç¸®å° */
  	  margin-bottom: 1px !important;
  	  opacity: 0.9;
	}

/* ä¸‹æ–¹çš„ã€Œç‰Œå¡åç¨±ã€(å¦‚ï¼šæ„šè€…) */
.card-name-text {
    font-size: 10px !important; /* è¨­å®šç‚º 11px æˆ– 12px */
    font-weight: bold;
    line-height: 1.2;
    text-overflow: ellipsis; /* è¶…å‡ºéƒ¨åˆ†è®Š... */
}
        
/* ä¿®æ”¹å¾Œçš„ .card.drawn */
.card.drawn {
    /* 1. é—œéµä¿®æ­£ï¼šå–æ¶ˆåŸæœ¬ CSS çš„ç½®ä¸­åç§»ï¼Œäº¤çµ¦ JS æ§åˆ¶ */
    margin: 0 !important; 
    
    /* 2. ç¢ºä¿å®šä½åŸºæº–é»åœ¨æ­£ä¸­é–“ */
    top: 50%;
    left: 50%;

    /* 3. ä¿ç•™éæ¸¡å‹•ç•« */
    transition: transform 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
}

/* â˜…â˜…â˜… é—œéµè¨­å®šï¼šæ»‘é¼ æ‡¸åœ (Hover) æ•ˆæœ â˜…â˜…â˜… */
.card.drawn:hover {
    /* 1. å±¤ç´šè®Šæœ€é«˜ï¼šç¢ºä¿è¢«è“‹ä½çš„ç‰Œæœƒç¬é–“è·‘åˆ°æœ€ä¸Šé¢ */
    z-index: 9999 !important; 
    
    /* 2. è¦–è¦ºæ‡¸æµ®æ„Ÿï¼šåŠ æ·±é™°å½±ï¼Œè®“å®ƒçœ‹èµ·ä¾†é›¢èƒŒæ™¯æ›´é  */
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.7) !important;
    
    /* 3. ç¨å¾®æ‰“äº®ï¼šè®“é¸ä¸­çš„ç‰Œçœ‹èµ·ä¾†ç™¼å…‰ */
    filter: brightness(1.1);
    
    /* 4. æ»‘é¼ æ¸¸æ¨™è®Šæ‰‹å‹ */
    cursor: pointer;
}
/* æ–°å¢ï¼šä¸‹æ‹‰é¸å–®æ¨£å¼ */
        select {
            padding: 10px 30px 10px 15px; /* å³é‚Šç•™å¤šä¸€é»ç©ºé–“çµ¦ç®­é ­ */
            font-size: 16px;
            cursor: pointer;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #d4af37;
            color: #d4af37;
            border-radius: 8px;
            outline: none;
            text-align: center;
            text-align-last: center;
            
            /* â˜… é—œéµä¿®æ­£ï¼šä¿ç•™æ‰‹æ©ŸåŸç”Ÿçš„ä¸‹æ‹‰é¸å–®ç®­é ­ï¼Œä¸ç„¶æœƒçœ‹èµ·ä¾†åƒæ²’åæ‡‰ â˜… */
            appearance: menulist; 
            -webkit-appearance: menulist;
        }
select:hover {
    background: #d4af37;
    color: #000;
}
option {
    background: #000;
    color: #d4af37;
}

@media (max-width: 600px) {
    select {
        max-width: 100px; /* æ‰‹æ©Ÿç‰ˆé¸å–®ä¸è¦å¤ªå¯¬ */
        font-size: 12px;
    }
}
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); 
            
            /* â˜…â˜…â˜… ä¿®æ”¹é€™è£¡ï¼šå±¤ç´šè¦æ¯” hint (20002) é‚„é«˜ï¼Œé€™æ¨£è¦–çª—æ‰æœƒè“‹éæ–‡å­— â˜…â˜…â˜… */
            z-index: 30000 !important; 
            
            display: none; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s;
        }
        .modal-content {
            background: #1a1a1a; border: 2px solid #d4af37; color: #fff;
            padding: 0; width: 90%; max-width: 550px; border-radius: 15px;
            text-align: center; box-shadow: 0 0 40px rgba(212, 175, 55, 0.2);
            transform: translateY(20px); transition: transform 0.3s;
            overflow: hidden; display: flex; flex-direction: column;
            max-height: 85vh;
        }
        .modal-header {
            background: linear-gradient(90deg, #2c3e50, #000);
            padding: 20px; border-bottom: 1px solid #d4af37;
        }
        .modal-title { color: #d4af37; font-size: 22px; font-weight: bold; margin: 0;}
        .modal-subtitle { color: #aaa; font-size: 14px; margin-top: 5px; }
        .modal-body {
            padding: 20px; overflow-y: auto; flex: 1; text-align: left; line-height: 1.6; color: #ddd;
        }
        /* ç¬¬ä¸€å±¤æ¨£å¼ */
        .image-desc-box {
            background: rgba(255,255,255,0.05); padding: 15px;
            border-radius: 8px; margin-bottom: 20px; font-size: 15px;
            border-left: 3px solid #d4af37;
        }
        .category-grid {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px;
        }
        .cat-btn {
            background: transparent; border: 1px solid #555; color: #ccc;
            padding: 10px 5px; border-radius: 8px; cursor: pointer;
            transition: all 0.2s; font-size: 14px;
        }
        .cat-btn:hover { background: #d4af37; color: #000; border-color: #d4af37; }
        /* ç¬¬äºŒå±¤æ¨£å¼ */
        .detail-view { display: none; animation: fadeIn 0.3s; }
        .detail-title {
            color: #f1c40f; font-size: 18px; font-weight: bold; margin-bottom: 10px;
            text-align: center; border-bottom: 1px solid #444; padding-bottom: 10px;
        }
        .detail-content { font-size: 15px; margin-bottom: 20px; }
        .back-btn {
            width: 100%; padding: 10px; background: #444; color: white;
            border: none; border-radius: 8px; cursor: pointer; margin-top: 10px;
        }
        .back-btn:hover { background: #666; }
        .modal-footer { padding: 15px; background: #111; border-top: 1px solid #333; }
        .modal-close {
            background: #d4af37; color: #000; border: none; padding: 10px 40px;
            border-radius: 20px; cursor: pointer; font-weight: bold; font-size: 16px; width: 100%;
        }
        .modal-overlay.active { display: flex; opacity: 1; }
        .modal-overlay.active .modal-content { transform: translateY(0); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="hint" id="statusText">è«‹æº–å‚™é–‹å§‹å„€å¼</div>
    <div class="table-area" id="tableArea"></div>
<div id="focusOverlay">
    <div class="focus-text">è«‹æƒ³è‘—ä½ çš„å•é¡Œ...</div>
</div>

<div class="controls">
    <select id="categorySelector">
        <option value="general">ğŸ”® ç¶œåˆé‹å‹¢</option>
        <option value="love">â¤ï¸ æ„›æƒ…æƒ…æ„Ÿ</option>
        <option value="work">ğŸ’¼ å·¥ä½œäº‹æ¥­</option>
        <option value="finance">ğŸ’° è²¡å‹™é‡‘éŒ¢</option>
        <option value="academic">ğŸ“ å­¸æ¥­è€ƒè©¦</option>
        <option value="friendship">ğŸ¤ äººéš›é—œä¿‚</option>
        <option value="family">ğŸ  å®¶åº­è¦ªæƒ…</option>
    </select>

    <select id="spreadBasic" onchange="changeSpread('basic')">
        <option value="" disabled selected>ğŸ”° åŸºç¤ç‰Œé™£</option>
        <option value="single">å–®å¼µç‰Œ </option>
        <option value="time">æ™‚é–“ä¹‹æµ (éå»/ç¾åœ¨/æœªä¾†)</option>
	<option value="happiness">å¹¸ç¦æŒ‡æ•¸ (æœ¬æœˆé‹å‹¢)</option>
        <option value="self">è‡ªæˆ‘æ¢ç´¢ (äº†è§£è‡ªå·±çš„å…§å¿ƒ)</option>
	<option value="find_partner">å°‹æ‰¾å°è±¡å åœæ³•</option>
        <option value="choice">äºŒæ“‡ä¸€ (å…©é›£é¸æ“‡)</option>
	<option value="friendship">å‹èª¼å åœ (å åœé›™æ–¹å‹èª¼)</option>
    </select>

    <select id="spreadAdv" onchange="changeSpread('adv')">
        <option value="" disabled selected>âœ¨ é€²éšç‰Œé™£</option>
        <option value="hexagram">å…­èŠ’æ˜Ÿ (æ‰¾å‡ºäº‹æƒ…çš„å› ç”±)</option>
        <option value="love_real">æ„›æƒ…çœŸå¿ƒ (äº†è§£è‡ªå·±å’Œå°æ–¹çš„å¿ƒæ„)</option>
        <option value="lovers_pyramid">æˆ€äººé‡‘å­—å¡” (å…©äººç™¼å±•çš„å¯èƒ½æ€§)</option> 
        <option value="celtic">å…‹çˆ¾ç‰¹åå­— (å°‹æ‰¾å•é¡ŒçœŸæ­£æ‰€åœ¨)</option>
	<option value="future">æœªä¾†ç™¼å±•å åœæ³•(å åœæœªä¾†çš„è‡ªå·±)</option>
	<option value="karmic">å¡çˆ¾ç±³å…‹ (æ¢è¨è‡ªå·±çš„å‘½é‹)</option>
    </select>
    <button id="btnShuffle" onclick="startRitual()">æ´—ç‰Œ</button>
    <button id="btnSpread" onclick="spreadDeck()" disabled>å±•é–‹</button>
    
    <button id="btnReveal" onclick="startReveal()" style="display:none; border-color: #f1c40f; color: #f1c40f;">é–‹å§‹è§£ç‰Œ</button>
    
    <button id="btnReset" onclick="resetGame()" style="display:none; border-color: #fff; color: #000;">é‡ç½®</button>
</div>

    <div class="modal-overlay" id="meaningModal">
        <div class="modal-content">
		<button class="nav-btn prev" onclick="navigateCard(-1)">&#10094;</button>
   		<button class="nav-btn next" onclick="navigateCard(1)">&#10095;</button>
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">ç‰Œå</div>
                <div class="modal-subtitle" id="modalStatus">æ­£ä½ / é€†ä½</div>
            </div>
            <div class="modal-body">
                <div id="mainView">
                    <div class="image-desc-box">
                        <strong style="color: #d4af37;">ã€ç‰Œé¢åœ–è§£ã€‘</strong><br>
                        <span id="imageDescText">...</span>
                    </div>
                    <p style="text-align: center; color: #aaa; margin-bottom: 10px;">è«‹é¸æ“‡æƒ³äº†è§£çš„é¢å‘ï¼š</p>
                    <div class="category-grid">
                        <button class="cat-btn" onclick="showDetail('character')">ğŸ‘¤ äººç‰©</button>
                        <button class="cat-btn" onclick="showDetail('work')">ğŸ’¼ å·¥ä½œ</button>
                        <button class="cat-btn" onclick="showDetail('love')">â¤ï¸ æ„›æƒ…</button>
                        <button class="cat-btn" onclick="showDetail('friendship')">ğŸ¤ å‹æƒ…</button>
                        <button class="cat-btn" onclick="showDetail('family')">ğŸ  è¦ªæƒ…</button>
                        <button class="cat-btn" onclick="showDetail('academic')">ğŸ“ å­¸æ¥­</button>
                        <button class="cat-btn" onclick="showDetail('finance')">ğŸ’° è²¡å‹™</button>
                    </div>
                    <div class="modal-card-img-container">
                        <p style="margin: 20px 0 10px; color: #666; font-size: 12px;">â–¼ ä¸‹æ»‘æª¢è¦–ç‰Œé¢ â–¼</p>
                        <img id="modalCardImage" src="" class="modal-card-img" alt="ç‰Œé¢åœ–æ¡ˆ">
                    </div>
                </div> <div id="detailView" class="detail-view">
                    <div class="detail-title" id="detailTitle">é¡åˆ¥æ¨™é¡Œ</div>
                    <div class="detail-content" id="detailContent">å…§å®¹...</div>
                    <button class="back-btn" onclick="backToMain()">â¬… è¿”å›é¸å–®</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-close" onclick="closeModal()">é—œé–‰è¦–çª—</button>
            </div>
        </div>
    </div>

<script src="tarot-data.js"></script>
<script>
    // --- è¨­å®šèˆ‡å…¨åŸŸè®Šæ•¸ ---
    const TOTAL_CARDS = 78;
    let currentViewingIndex = 0;
    let cardsDOM = [];
    let isSpread = false;
    let hasDrawn = false;
    let isAnimating = false; 
    let currentResult = null;
    let activeCardData = null;
    let activeIsReversed = false;
    let shuffledDeck = []; 
    let selectedCardsDOM = []; // æš«å­˜å·²é¸æ“‡çš„ç‰Œ

    // --- 1. å®šç¾©ç‰Œé™£è³‡æ–™ ---
    const SPREAD_DATA = {
        'happiness': {
            name: "å¹¸ç¦æŒ‡æ•¸å åœæ³•",
            positions: ["æœ¬é€±é‹ç¨‹", "ä¸‹é€±é‹ç¨‹", "ç¬¬ä¸‰é€±é‹ç¨‹", "ç¬¬å››é€±é‹ç¨‹", "ç¬¬äº”é€±é‹ç¨‹"],
            layout: [{x: -240, y: 0}, {x: -120, y: 0}, {x: 0, y: 0}, {x: 120, y: 0}, {x: 240, y: 0}],
            desc: "é æ¸¬æ•´å€‹æœˆçš„æ¯é€±é‹å‹¢èµ·ä¼ã€‚"
        },
        'single': {
            name: "å–®å¼µç‰Œå åœ",
            positions: ["æ ¸å¿ƒ"],
            layout: [{x: 0, y: 0}],
            desc: "é©åˆç°¡å–®çš„æ˜¯éé¡Œæˆ–æ¯æ—¥é‹å‹¢ã€‚"
        },
        'time': {
            name: "æ™‚é–“ä¹‹æµç‰Œé™£",
            positions: ["éå»çš„ç¶“é©—", "ç¾åœ¨çš„ç‹€æ³", "æœªä¾†çš„é æ¸¬"],
            layout: [{x: -120, y: 0}, {x: 0, y: 0}, {x: 120, y: 0}],
            desc: "æª¢è¦–äº‹æƒ…çš„ä¾†é¾å»è„ˆã€‚"
        },
        'self': {
            name: "è‡ªæˆ‘æ¢ç´¢ç‰Œé™£",
            positions: ["å…§å¿ƒæ·±è™•", "ç²¾ç¥ç”Ÿæ´»", "çŸ¥è­˜é ˜åŸŸ", "æ„Ÿæƒ…ç”Ÿæ´»"],
            layout: [{x: 0, y: 0}, {x: 0, y: -250}, {x: -200, y: 250}, {x: 200, y: 250}],
            desc: "å…¨æ–¹ä½äº†è§£è‡ªå·±çš„èº«å¿ƒéˆç‹€æ…‹ã€‚"
        },
        'find_partner': {
            name: "å°‹æ‰¾å°è±¡å åœæ³•",
            positions: ["ç¾åœ¨çš„å¿ƒæƒ…å’Œè™•å¢ƒ", "å¸Œæœ›è¿½æ±‚çš„é¡å‹", "ä½ ä¸å–œæ­¡çš„é¡å‹", "è©²æ¡å–çš„è¡Œå‹•", "æœªä¾†çš„ç™¼å±•"],
            layout: [{x: 0, y: 0}, {x: -200, y: -200}, {x: 200, y: -200}, {x: -200, y: 200}, {x: 200, y: 200}],
            desc: "å°ˆç‚ºå–®èº«è€…è¨­è¨ˆã€‚"
        },
        'choice': {
            name: "äºŒæ“‡ä¸€ç‰Œé™£",
            positions: ["ç¾æ³", "é¸æ“‡Açš„éç¨‹", "é¸æ“‡Bçš„éç¨‹", "é¸æ“‡Açš„çµæœ", "é¸æ“‡Bçš„çµæœ"],
            layout: [{x: 0, y: 150}, {x: -100, y: 0}, {x: -180, y: -120}, {x: 100, y: 0}, {x: 180, y: -120}],
            desc: "é¢è‡¨æŠ‰æ“‡æ™‚ä½¿ç”¨ã€‚"
        },
        'friendship': {
            name: "å‹èª¼å åœæ³•",
            positions: ["ä½ å°å°æ–¹çš„çœ‹æ³•", "å°æ–¹å°ä½ çš„çœ‹æ³•", "ä½ èªç‚ºç›®å‰é—œä¿‚", "å°æ–¹èªç‚ºç›®å‰é—œä¿‚", "ä½ æœŸæœ›æœªä¾†ç™¼å±•", "å°æ–¹æœŸæœ›æœªä¾†ç™¼å±•"],
            layout: [{x: -120, y: -100}, {x: -120, y: 100}, {x: 0, y: -100}, {x: 0, y: 100}, {x: 120, y: -100}, {x: 120, y: 100}],
            desc: "æ·±åº¦è§£æé›™æ–¹å°é€™æ®µé—œä¿‚çš„çœ‹æ³•ã€‚"
        },
        'celtic': {
            name: "å…‹çˆ¾ç‰¹åå­—ç‰Œé™£",
            positions: ["ç¾æ³", "é˜»ç¤™", "å…§åœ¨(å…§å¿ƒçš„å‹•æ©Ÿã€å•é¡Œçš„æ ¹æº)", "å¤–åœ¨(è‡ªæˆ‘çš„æœŸå¾…ã€æ½›åœ¨å¯èƒ½æ€§)", "éå»", "æœªä¾†", "è‡ªæˆ‘(é¢å°äº‹æƒ…çš„æ…‹åº¦)", "ç’°å¢ƒ(åˆ¥äººå°è‡ªå·±çš„çœ‹æ³•ã€å‘¨é­ç’°å¢ƒ)", "å¼•å°(é€™æ¬¡æœƒè®“ä½ å­¸åˆ°ä»€éº¼)", "çµæœ"],
            layout: [
                {x: -150, y: 0}, {x: -150, y: 0, rotate: 90}, {x: -150, y: -250}, {x: -150, y: 250}, 
                {x: -250, y: 0}, {x: 0, y: 0}, {x: 180, y: 300}, {x: 180, y: 100}, {x: 180, y: -100}, {x: 180, y: -300}
            ],
            desc: "ç¶“å…¸çš„æ·±åº¦å‰–æç‰Œé™£ã€‚"
        },
        'hexagram': {
            name: "å…­èŠ’æ˜Ÿç‰Œé™£",
            positions: ["éå»(å•é¡Œçš„åŸå› )", "ç¾åœ¨(å•é¡Œç¾åœ¨è™•æ–¼ä½•ç¨®ç‹€æ…‹)", "æœªä¾†(ä¹‹å¾Œæœƒæœ‰ç”šéº¼è®ŠåŒ–)", "è§£æ±ºæ–¹æ³•", "ç’°å¢ƒ(è·Ÿæ­¤äº‹ä»¶æœ‰é—œçš„äººäº‹ç‰©æƒ…æ³)", "é¡˜æœ›(ä½ å°šæœªå¯Ÿè¦ºä½†å»æ˜¯ä½ å¿ƒä¸­çœŸæ­£æ‰€è¦)", "çµæœ"],
            layout: [{x: 0, y: -200}, {x: 150, y: 80}, {x: -150, y: 80}, {x: 0, y: 200}, {x: -150, y: -80}, {x: 150, y: -80}, {x: 0, y: 0}],
            desc: "å…¨æ–¹ä½æ·±å…¥åˆ†æã€‚"
        },
        'lovers_pyramid': {
            name: "æˆ€äººé‡‘å­—å¡”",
            positions: ["ä½ å°å°æ–¹çš„æƒ³æ³•", "å°æ–¹å°ä½ çš„æƒ³æ³•", "ä½ å°å…©äººé—œä¿‚çš„çœ‹æ³•", "æœ‰æ²’æœ‰çµå©šçš„æ‰“ç®—", "ä½ è©²åšçš„è¡Œå‹•", "å…©äººç›®å‰çš„é¡§æ…®", "æœ€å¾Œçµæœ"],
            layout: [{x: 0, y: 220}, {x: -130, y: 120}, {x: 130, y: 120}, {x: 0, y: 20}, {x: -130, y: -80}, {x: 130, y: -80}, {x: 0, y: -180}],
            desc: "é æ¸¬å…©äººç™¼å±•å¯èƒ½æ€§ã€‚"
        },
        'karmic': {
            name: "å¡çˆ¾ç±³å…‹å±•é–‹æ³•",
            positions: ["ä½ çš„å®¿å‘½", "ä½ çš„å€‹æ€§", "å½±éŸ¿ä½ é€™è¼©å­çš„é‡å¤§äº‹ä»¶", "é€™è¼©å­ç¬¬äºŒç¨®å½±éŸ¿", "ä½ ä¾†é€™ä¸–ä¸Šçš„ç›®çš„", "ä½ é€™è¼©å­èƒ½å®Œæˆä»€éº¼", "ä½ é€™è¼©å­æœƒå­¸ç¿’åˆ°ä»€éº¼"],
            layout: [{x: 180, y: 180}, {x: 100, y: 180}, {x: -180, y: 180}, {x: -100, y: 180}, {x: 100, y: -150}, {x: -100, y: -150}, {x: 0, y: 0}],
            desc: "æ¢è¨å‘½é‹èˆ‡éˆé­‚ä½¿å‘½ã€‚"
        },
        'future': {
            name: "æœªä¾†ç™¼å±•å åœæ³•",
            positions: ["ç¾æ³", "æ„›æƒ…", "äº‹æ¥­", "è²¡é‹", "æˆå°±", "çµæœ"],
            layout: [{x: 0, y: -250}, {x: -250, y: -100}, {x: 250, y: -100}, {x: -250, y: 100}, {x: 250, y: 100}, {x: 0, y: 250}],
            desc: "åˆ†æäº‹ä»¶ç™¼å±•è„ˆçµ¡ã€‚"
        },
        'love_real': {
            name: "æ„›æƒ…çœŸå¿ƒå åœæ³•",
            positions: ["ä½ çš„çœ‹æ³•", "å°æ–¹çš„çœ‹æ³•", "å…©äººé—œä¿‚è®ŠåŒ–å°ä½ çš„å½±éŸ¿", "å…©äººé—œä¿‚è®ŠåŒ–å°å°æ–¹çš„å½±éŸ¿", "ä½ æœªä¾†çš„å¿ƒæƒ…", "çµæœ", "å°‡ä¾†å¯èƒ½çš„éšœç¤™", "å°æ–¹æœªä¾†çš„å¿ƒæƒ…"],
            layout: [{x: -150, y: -120}, {x: 150, y: -120}, {x: 0, y: -300}, {x: 0, y: -50}, {x: 0, y: 100}, {x: 0, y: 200}, {x: -140, y: 100}, {x: 140, y: 100}],
            desc: "æ·±åº¦å‰–æé›™æ–¹å¿ƒæ„ã€‚"
        }
    };

    let currentSpreadKey = 'single';
    let drawnCount = 0;
    let drawnResults = []; 
    
    // --- åˆ‡æ›é¸å–®é‚è¼¯ ---
    function changeSpread(source) {
        const basicSelect = document.getElementById('spreadBasic');
        const advSelect = document.getElementById('spreadAdv');

        if (source === 'basic') {
            advSelect.value = "";
            currentSpreadKey = basicSelect.value;
        } else if (source === 'adv') {
            basicSelect.value = "";
            currentSpreadKey = advSelect.value;
        }
        resetGameDataOnly();
    }

    // --- åˆå§‹åŒ– ---
    function init() {
        const table = document.getElementById('tableArea');
        table.innerHTML = "";
        cardsDOM = [];
        shuffledDeck = Array.from({length: TOTAL_CARDS}, (_, i) => i);

        for (let i = 0; i < TOTAL_CARDS; i++) {
            const el = document.createElement('div');
            el.className = 'card';
            el.dataset.index = i;
            el.style.setProperty('--tx', '0px');
            el.style.setProperty('--ty', '0px');
            el.style.setProperty('--rot', '0deg');
            el.style.zIndex = i;
            el.innerHTML = `<div class="card-inner"><div class="front"></div><div class="back"></div></div>`;
            el.onclick = () => onCardClick(el);
            table.appendChild(el);
            cardsDOM.push(el);
        }
        
        const spreadInfo = SPREAD_DATA[currentSpreadKey];
        if(spreadInfo) {
             updateStatus(`ç›®å‰æ¨¡å¼ï¼š${spreadInfo.name}ã€‚è«‹å…ˆé¸æ“‡ã€Œå åœé¢å‘ã€ä¸¦é»æ“Šã€Œæ´—ç‰Œã€`);
        } else {
             updateStatus("è«‹é»æ“Šã€Œæ´—ç‰Œã€é–‹å§‹å„€å¼");
        }
    }

    // --- é‡ç½®éŠæˆ²æ•¸æ“š ---
    function resetGameDataOnly() {
        drawnCount = 0;
        drawnResults = [];
        selectedCardsDOM = []; 
        hasDrawn = false;
        isSpread = false;
        init(); 
        document.getElementById('btnShuffle').style.display = 'inline-block';
        document.getElementById('btnSpread').style.display = 'inline-block';
        document.getElementById('btnSpread').disabled = true;
        document.getElementById('btnShuffle').disabled = false;
        document.getElementById('btnReset').style.display = 'none';
        document.getElementById('btnReveal').style.display = 'none';
    }

    // --- æ´—ç‰Œé‚è¼¯ ---
    function internalShuffle() {
        for (let i = shuffledDeck.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [shuffledDeck[i], shuffledDeck[j]] = [shuffledDeck[j], shuffledDeck[i]];
        }
    }

async function startRitual() {
        // 1. å–å¾—ä»‹é¢å…ƒç´ 
        const overlay = document.getElementById('focusOverlay');
        const controls = document.querySelector('.controls');
        const hint = document.getElementById('statusText');
        
        // 2. éš±è—ä»‹é¢ï¼Œé¡¯ç¤ºå†¥æƒ³ç•«é¢
        controls.style.opacity = '0'; 
        hint.style.opacity = '0';
        overlay.style.display = 'flex'; 
        void overlay.offsetWidth; 
        overlay.style.opacity = '1';
        
        // 3. ç­‰å¾… 3 ç§’ (å†¥æƒ³æ™‚é–“)
        await new Promise(resolve => setTimeout(resolve, 3000));

        // â˜…â˜…â˜… éš±è—ä¸‹æ‹‰é¸å–®ï¼Œåªç•™ä¸‹æŒ‰éˆ• (é€™æ˜¯ä½ ä¸Šä¸€å€‹éœ€æ±‚) â˜…â˜…â˜…
        document.getElementById('categorySelector').style.display = 'none';
        document.getElementById('spreadBasic').style.display = 'none';
        document.getElementById('spreadAdv').style.display = 'none';

        // 4. æ·¡å‡ºå†¥æƒ³ç•«é¢ï¼Œé¡¯ç¤ºå›ä»‹é¢
        overlay.style.opacity = '0';
        await new Promise(resolve => setTimeout(resolve, 1500));
        overlay.style.display = 'none';
        hint.style.opacity = '1'; 
        controls.style.opacity = '1';

        // 5. é–‹å§‹åŸ·è¡Œæ´—ç‰Œå‹•ç•«é‚è¼¯
        document.getElementById('btnShuffle').disabled = true;
        updateStatus("æ­£åœ¨æ‰“äº‚ç‰Œé™£...");
        internalShuffle();
        
        await animateMessyShuffle();
        
        updateStatus("æ•´ç†ç‰Œå †...");
        await animateGather();
        
        updateStatus("åˆ‡ç‰Œ...");
        await animateCutDeck();
        
        // 6. å‹•ç•«çµæŸï¼Œå•Ÿç”¨å±•é–‹æŒ‰éˆ•
        updateStatus("ç‰Œå †å·²æ·¨åŒ–ï¼Œè«‹é»æ“Šã€Œå±•é–‹ã€");
        document.getElementById('btnSpread').disabled = false;
    }

    function animateMessyShuffle() {
        return new Promise(resolve => {
            cardsDOM.forEach(card => {
                const tx = (Math.random() - 0.5) * window.innerWidth * 0.8;
                const ty = (Math.random() - 0.5) * window.innerHeight * 0.6;
                const rot = (Math.random() - 0.5) * 720;
                card.style.setProperty('--tx', tx + 'px');
                card.style.setProperty('--ty', ty + 'px');
                card.style.setProperty('--rot', rot + 'deg');
            });
            setTimeout(resolve, 1000);
        });
    }

    function animateGather() {
        return new Promise(resolve => {
            cardsDOM.forEach((card, index) => {
                card.style.setProperty('--tx', '0px');
                card.style.setProperty('--ty', -index * 0.2 + 'px');
                card.style.setProperty('--rot', '0deg');
                card.style.zIndex = index;
            });
            setTimeout(resolve, 800);
        });
    }
    
    function animateCutDeck() {
        return new Promise(resolve => {
            const cutIndex = Math.floor(TOTAL_CARDS / 2);
            cardsDOM.forEach((card, i) => {
                if(i >= cutIndex) {
                    card.style.setProperty('--tx', '120px');
                    card.style.setProperty('--ty', -i * 0.2 + 'px');
                    card.style.setProperty('--rot', '5deg');
                } else {
                    card.style.setProperty('--tx', '-120px');
                    card.style.setProperty('--ty', -i * 0.2 + 'px');
                    card.style.setProperty('--rot', '-5deg');
                }
            });
            setTimeout(() => {
                cardsDOM.forEach((card, index) => {
                    card.style.setProperty('--tx', '0px');
                    card.style.setProperty('--ty', -index * 0.2 + 'px');
                    card.style.setProperty('--rot', '0deg');
                });
                setTimeout(resolve, 800);
            }, 800);
        });
    }

    function spreadDeck() {
        isSpread = true;
        document.getElementById('btnSpread').disabled = true;
        document.getElementById('btnShuffle').style.display = 'none';
        document.getElementById('btnSpread').style.display = 'none';
        
        const isMobile = window.innerWidth < 600;
        const angleRange = isMobile ? 100 : 140; 
        const radius = isMobile ? 300 : 500; 
        const yOffset = isMobile ? 250 : 350;
        const startAngle = -(angleRange / 2); 
        const step = angleRange / (TOTAL_CARDS - 1);

        cardsDOM.forEach((card, index) => {
            const angle = startAngle + (index * step);
            const radian = angle * (Math.PI / 180);
            const x = radius * Math.sin(radian);
            const y = -radius * Math.cos(radian) + yOffset; 
            
            card.classList.add('spread'); 
            
            card.style.setProperty('--tx', x + 'px');
            card.style.setProperty('--ty', y + 'px');
            card.style.setProperty('--rot', angle + 'deg');
            
            // è¨˜éŒ„æ‰‡å½¢ä½ç½®
            card.dataset.fanTx = x;
            card.dataset.fanTy = y;
            card.dataset.fanRot = angle;

            card.style.transform = `translate(${x}px, ${y}px) rotate(${angle}deg)`;
            card.style.zIndex = index;
        });

        const spreadInfo = SPREAD_DATA[currentSpreadKey];
        updateStatus(`è«‹æ†‘ç›´è¦ºæŠ½å‡ºç¬¬ 1 å¼µç‰Œï¼šã€${spreadInfo.positions[0]}ã€‘`);
    }

    // --- æ ¸å¿ƒï¼šé»æ“ŠæŠ½ç‰Œ (å †ç–Š + ä½ˆé™£) ---
    function onCardClick(card) {
        if (isAnimating) return;

        // 1. å¦‚æœå·²ç¶“ä½ˆé™£å®Œæˆï¼Œé»æ“Šå‰‡æ˜¯é–‹å•Ÿè§£ç‰Œè¦–çª—
        if (hasDrawn && card.classList.contains('drawn')) {
            const resultIndex = parseInt(card.dataset.drawnIndex);
            if (!isNaN(resultIndex)) {
                currentViewingIndex = resultIndex;
                showModal();
            }
            return;
        }

        const spreadInfo = SPREAD_DATA[currentSpreadKey];
        const totalNeeded = spreadInfo.positions.length;

        // 2. é¸ç‰Œéšæ®µ (é‚„æ²’ä½ˆé™£)
        if (isSpread && !hasDrawn) {
            
            // (A) å¦‚æœé»åˆ°å·²ç¶“é¸éçš„ç‰Œ -> å–æ¶ˆé¸æ“‡
            if (selectedCardsDOM.includes(card)) {
                selectedCardsDOM = selectedCardsDOM.filter(c => c !== card);
                card.classList.remove('selected');
                
                // é£›å›åŸæœ¬æ‰‡å½¢ä½ç½®
                card.style.setProperty('--tx', card.dataset.fanTx + 'px');
                card.style.setProperty('--ty', card.dataset.fanTy + 'px');
                card.style.setProperty('--rot', card.dataset.fanRot + 'deg');
                card.style.transform = `translate(${card.dataset.fanTx}px, ${card.dataset.fanTy}px) rotate(${card.dataset.fanRot}deg)`;
                card.style.zIndex = card.dataset.index;
                
                updateStatus(`å·²å–æ¶ˆé¸æ“‡ã€‚ç›®å‰å·²é¸ ${selectedCardsDOM.length} / ${totalNeeded} å¼µ`);
                return;
            }

            // (B) æª¢æŸ¥æ˜¯å¦å·²é¸æ»¿
            if (selectedCardsDOM.length >= totalNeeded) return;

            // (C) åŸ·è¡Œé¸æ“‡ï¼šé£›åˆ°ä¸­é–“å †ç–Š
            selectedCardsDOM.push(card);
            card.classList.add('selected'); 
            
            const randomRot = (Math.random() * 10 - 5); 
            // å¼·åˆ¶è¨­å®š style.transform è¦†è“‹æ‰‡å½¢ä½ç½®ï¼Œé£›åˆ°ç•«é¢ä¸­å¤®ä¸‹æ–¹å †ç–Š
            card.style.transform = `translate(0px, 150px) rotate(${randomRot}deg) scale(1)`;
            card.style.zIndex = 1000 + selectedCardsDOM.length; 
            
            let currentCount = selectedCardsDOM.length;
            if (currentCount < totalNeeded) {
                updateStatus(`å·²é¸æ“‡ ${currentCount} / ${totalNeeded} å¼µï¼Œä¸‹ä¸€å¼µä½ç½®ï¼šã€${spreadInfo.positions[currentCount]}ã€‘`);
            } else {
                // (D) é¸æ»¿äº†ï¼è‡ªå‹•è§¸ç™¼ä½ˆé™£
                updateStatus(`å·²é¸æ»¿ ${totalNeeded} å¼µï¼Œæ­£åœ¨ä½ˆé™£...`);
                setTimeout(performBatchPlacement, 600);
            }
        }
    }
// --- æ‰¹æ¬¡ä½ˆé™£å‹•ç•« (ä¿®æ”¹ç‰ˆï¼šåŠ å…¥å‹•æ…‹ç­‰æ¯”ä¾‹ç¸®æ”¾) ---
    function performBatchPlacement() {
        isAnimating = true;
        const spreadInfo = SPREAD_DATA[currentSpreadKey];
        
        // 1. å…ˆæŠŠæ²’è¢«é¸åˆ°çš„ç‰Œéš±è—èµ·ä¾†
        cardsDOM.forEach(c => {
            if (!selectedCardsDOM.includes(c)) {
                c.style.transition = "opacity 0.5s";
                c.style.opacity = '0';
                c.style.pointerEvents = 'none';
            }
        });

        // 2. ä¾åºå°‡é¸å¥½çš„ç‰Œé£›åˆ°æŒ‡å®šä½ç½®
        selectedCardsDOM.forEach((card, index) => {
            // å–å¾—å°æ‡‰çš„è³‡æ–™
            const cardIndex = parseInt(card.dataset.index);
            const drawId = shuffledDeck[cardIndex];
            const isReversed = Math.random() < 0.5;
            const currentPosName = spreadInfo.positions[index];
            const currentLayout = spreadInfo.layout[index];
            
            let data = null;
            if (typeof getCardData === 'function') { data = getCardData(drawId); }
            else { data = { name: "è®€å–ä¸­...", id: drawId }; }

            // å„²å­˜çµæœ
            drawnResults.push({
                id: drawId, name: data.name, isReversed: isReversed,
                positionName: currentPosName, index: index
            });

            // è¨­å®š DOM ç‹€æ…‹
            card.dataset.drawnIndex = index;
            card.classList.remove('spread');
            card.classList.remove('selected'); 
            card.classList.add('drawn');       

            // â˜…â˜…â˜… ä¿®æ”¹é‡é»ï¼šå‹•æ…‹è¨ˆç®—ç¸®æ”¾æ¯”ä¾‹ (Dynamic Scale) â˜…â˜…â˜…
            const screenW = window.innerWidth;
            const isMobile = screenW < 600;
            
            // 1. è¨ˆç®—ç©ºé–“èˆ‡ä½ç½®çš„ç¸®æ”¾ (é¿å…ç‰Œé‡ç–Šå¤ªåš´é‡)
            const spaceScale = isMobile ? 0.45 : 1; 

            // 2. è¨ˆç®—å¡ç‰‡æœ¬èº«çš„ç¸®æ”¾å¤§å° (ä¾æ“šè¢å¹•å¯¬åº¦ç­‰æ¯”ä¾‹èª¿æ•´)
            let sizeScale;
            if (isMobile) {
                // æ‰‹æ©Ÿç‰ˆï¼šæ ¹æ“šè¢å¹•å¯¬åº¦è¨ˆç®—ï¼Œè®“ç‰Œç›¡é‡å¤§ä½†ä¸å‡ºç•Œ
                // å…¬å¼ï¼šè¢å¹•è¶Šå¯¬ï¼Œç‰Œè¶Šå¤§ã€‚é™åˆ¶åœ¨ 0.6 ~ 0.9 å€ä¹‹é–“
                sizeScale = screenW / 500; 
                if (sizeScale > 0.9) sizeScale = 0.9; // æœ€å¤§ä¸è¶…é 0.9
                if (sizeScale < 0.6) sizeScale = 0.6; // æœ€å°ä¸ä½æ–¼ 0.6
            } else {
                // é›»è…¦ç‰ˆï¼šå›ºå®šæ”¾å¤§ 1.4 å€
                sizeScale = 1.4;
            }
            
            const finalX = currentLayout.x * spaceScale;
            const finalY = currentLayout.y * spaceScale;
            
            // å¦‚æœç‰Œé™£è¨­è¨ˆæœ‰æ—‹è½‰è§’åº¦ï¼Œå‰‡è®€å–ï¼›å¦å‰‡ç‚º 0
            let rotateDeg = currentLayout.rotate || 0;

            // è¨­å®šå‹•ç•«å»¶é²ï¼Œè®“ç‰Œä¸€å¼µä¸€å¼µé£›éå»
// è«‹æ‰¾åˆ° performBatchPlacement å‡½å¼æœ€ä¸‹æ–¹çš„ setTimeout å€å¡Š
            setTimeout(() => {
                // é€™è£¡çš„ scale(${sizeScale}) å°±æ˜¯æ§åˆ¶ç­‰æ¯”ä¾‹ç¸®æ”¾çš„é—œéµ
                card.style.transform = `translate(calc(-50% + ${finalX}px), calc(-50% + ${finalY}px)) rotate(${rotateDeg}deg) scale(${sizeScale})`;
                card.style.zIndex = 100 + index;
                
                // é å…ˆå¡«å…¥èƒŒé¢å…§å®¹ (ä¿æŒè“‹ç‰Œç‹€æ…‹)
                const backDiv = card.querySelector('.back');
                const imgPath = `images/${drawId}.jpg`;

                // â˜…â˜…â˜… ä¿®æ”¹é€™è£¡ï¼šç§»é™¤ä¸‹æ–¹çš„æ–‡å­—å€å¡Šï¼Œä¸¦å¼·åˆ¶åœ–ç‰‡æ»¿ç‰ˆ â˜…â˜…â˜…
                backDiv.innerHTML = `
                    <div class="back-img-container" style="height: 100%; width: 100%; display: block;">
                        <img src="${imgPath}" 
                            style="width: 100%; height: 100%; object-fit: fill; display: block; ${isReversed ? 'transform: rotate(180deg)' : ''}" 
                            onerror="this.src='https://via.placeholder.com/300x525?text=Card'">
                    </div>
                `;
            }, index * 200); 
        });

        // 3. å‹•ç•«çµæŸå¾Œé¡¯ç¤ºæŒ‰éˆ•
        setTimeout(() => {
            updateStatus("ç‰Œé™£å·²å®Œæˆï¼Œè«‹é»æ“Šä¸‹æ–¹ã€Œé–‹å§‹è§£ç‰Œã€");
    
            const btnReveal = document.getElementById('btnReveal');
            const btnReset = document.getElementById('btnReset');
    
            // â˜…â˜…â˜… é—œéµä¿®æ­£ï¼šç¢ºä¿æŒ‰éˆ•æ¨£å¼æ­£ç¢ºé¡¯ç¤º â˜…â˜…â˜…
            // æ¸…é™¤ä¹‹å‰çš„ display:noneï¼Œå¼·åˆ¶è¨­å®šç‚º inline-block (é…åˆ Grid)
            btnReveal.style.cssText = "display: inline-block !important; border-color: #f1c40f; color: #f1c40f;";
            btnReset.style.cssText = "display: inline-block !important; border-color: #fff; color: #000;";
            
            hasDrawn = true;
            isAnimating = false;
        }, selectedCardsDOM.length * 200 + 500);
    }
    function startReveal() {
        if (drawnResults.length === 0) return;
        
        currentViewingIndex = 0;
        showModal();

        // â˜…â˜…â˜… ä¿®æ”¹é‡é» 2ï¼šé–‹å§‹è§£ç‰Œå¾Œï¼Œéš±è—æ‰€æœ‰é¸å–®èˆ‡æ“ä½œæŒ‰éˆ•ï¼Œåªç•™é‡ç½® â˜…â˜…â˜…
        document.getElementById('categorySelector').style.display = 'none';
        document.getElementById('spreadBasic').style.display = 'none';
        document.getElementById('spreadAdv').style.display = 'none';
        document.getElementById('btnShuffle').style.display = 'none';
        document.getElementById('btnSpread').style.display = 'none';
        
        // éš±è—ã€Œé–‹å§‹è§£ç‰Œã€æŒ‰éˆ•è‡ªå·±
        //document.getElementById('btnReveal').style.display = 'none';

        // ç¢ºä¿ã€Œé‡ç½®ã€æŒ‰éˆ•æ˜¯é¡¯ç¤ºçš„ (ä¸”å› ç‚ºæ˜¯ Grid æ’ç‰ˆï¼Œå®ƒæœƒè‡ªå‹•è£œä½)
        const btnReset = document.getElementById('btnReset');
        btnReset.style.display = 'inline-block';
        // å¦‚æœå¸Œæœ›é‡ç½®æŒ‰éˆ•é€™æ™‚å€™è®Šå¤§æˆ–æ»¿ç‰ˆï¼Œå¯ä»¥åœ¨é€™è£¡å‹•æ…‹èª¿æ•´ classï¼Œæˆ–æ˜¯ä¾è³´ CSS Grid è‡ªå‹•å¡«æ»¿
    }

    function navigateCard(direction) {
        const nextIndex = currentViewingIndex + direction;
        if (nextIndex >= 0 && nextIndex < drawnResults.length) {
            currentViewingIndex = nextIndex;
            showModal();
        }
    }

    // --- è©³ç´°è¦–çª— ---
    function showModal() {
        currentResult = drawnResults[currentViewingIndex];
        
        if(!currentResult) return;
        let data = getCardData(currentResult.id);
        if (!data) return;

        activeCardData = data;
        activeIsReversed = currentResult.isReversed;
        
        const prevBtn = document.querySelector('.nav-btn.prev');
        const nextBtn = document.querySelector('.nav-btn.next');
        if(prevBtn) prevBtn.style.display = (currentViewingIndex === 0) ? 'none' : 'block';
        if(nextBtn) nextBtn.style.display = (currentViewingIndex === drawnResults.length - 1) ? 'none' : 'block';

        document.getElementById('modalTitle').innerHTML = 
            `<span style="font-size:0.6em; color:#d4af37; display:block;">ä½ç½® ${currentResult.index + 1}ï¼š${currentResult.positionName}</span>` + 
            data.name;

        document.getElementById('modalStatus').innerText = activeIsReversed ? "ã€é€†ä½ã€‘ Reversed" : "ã€æ­£ä½ã€‘ Upright";
        document.getElementById('modalStatus').style.color = activeIsReversed ? "#e74c3c" : "#2ecc71";
        document.getElementById('imageDescText').innerText = data.image_desc || "æš«ç„¡åœ–è§£è³‡æ–™";

        const modalImg = document.getElementById('modalCardImage');
        if(modalImg) {
            modalImg.src = `images/${currentResult.id}.jpg`;
            modalImg.style.transform = activeIsReversed ? "rotate(180deg)" : "none";
        }

        const selectedCategory = document.getElementById('categorySelector').value;
        if (activeCardData.categories && activeCardData.categories[selectedCategory]) {
            showDetail(selectedCategory);
            document.getElementById('mainView').style.display = 'none'; 
        } else {
            document.getElementById('mainView').style.display = 'block';
            document.getElementById('detailView').style.display = 'none';
        }
        
        // é€£å‹•æ¡Œé¢çš„ç‰Œ
        document.querySelectorAll('.card').forEach(c => c.style.filter = 'brightness(1)');
        const targetCard = cardsDOM.find(c => parseInt(c.dataset.drawnIndex) === currentViewingIndex);
        if(targetCard) {
            targetCard.style.filter = 'brightness(1.5)';
            targetCard.style.zIndex = 9999;
            if (!targetCard.classList.contains('flipped')) {
                targetCard.classList.add('flipped');
            }
        }

        document.getElementById('meaningModal').classList.add('active');
    }

    function showDetail(categoryKey) {
        if (!activeCardData || !activeCardData.categories || !activeCardData.categories[categoryKey]) {
            alert("æ­¤é …ç›®æš«ç„¡è©³ç´°è³‡æ–™");
            return;
        }
        const catData = activeCardData.categories[categoryKey];
        document.getElementById('detailTitle').innerText = catData.label;
        const content = activeIsReversed ? catData.reversed : catData.upright;
        
        document.getElementById('detailContent').innerHTML = `
            <div style="margin-bottom: 10px; color: #aaa; font-size: 13px;">
                ${activeIsReversed ? "â–¼ é€†ä½æŒ‡å¼•" : "â–² æ­£ä½æŒ‡å¼•"}
            </div>
            <div style="line-height: 1.8; color: #fff;">${content}</div>
        `;
        document.getElementById('mainView').style.display = 'none';
        document.getElementById('detailView').style.display = 'block';
    }

    function backToMain() {
        document.getElementById('detailView').style.display = 'none';
        document.getElementById('mainView').style.display = 'block';
    }

    function closeModal() {
        document.getElementById('meaningModal').classList.remove('active');
    }
    
    document.getElementById('meaningModal').onclick = function(e) {
        if(e.target === this) closeModal();
    }

    function resetGame() {
        location.reload();
    }

    function updateStatus(text) {
        const el = document.getElementById('statusText');
        el.innerText = text;
        el.style.opacity = 1;
    }

    init();
</script>
</body>
</html>